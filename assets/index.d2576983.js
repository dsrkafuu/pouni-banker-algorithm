import{r as e,R as t,S as s,B as r,M as n,C as a,a as l,c as o,b as i,I as c,m as u,T as m,d as h,e as f,z as p}from"./vendor.351e3e21.js";var d={container:"_container_wsn8j_1"};var x="_container_dciul_1",N="_title_dciul_11",_="_author_dciul_17";var E=e.exports.memo((function(){return t.createElement("header",{className:x},t.createElement("h1",{className:N},"Banker's Algorithm"),t.createElement("span",{className:_},"B18030620"))}));var k="_control_mrxn3_1",g="_resource_mrxn3_7",y="_add_mrxn3_22",w="_status_mrxn3_30";var v=e.exports.memo((function({resNum:e,onResNumChange:o,onProcessAdd:i,status:c}){return t.createElement("div",{className:k},t.createElement("div",{className:g},t.createElement("span",null,"总资源数"),t.createElement(s,{value:e,onChange:o,min:1,max:5})),t.createElement("div",{className:y},t.createElement(r,{onClick:i},"添加进程")),t.createElement("div",{className:w},t.createElement("span",null,"当前状态"),t.createElement("span",null,null===c?t.createElement(n,null):c?t.createElement(a,{twoToneColor:"#52c41a"}):t.createElement(l,{twoToneColor:"#ff4d4f"}))))}));var b="_modal_o7jim_1";var C=e.exports.memo((function({visible:s=!1,title:r="",num:n,min:a,onOk:l,onCancel:u}){const[m,h]=e.exports.useState([]),f=e.exports.useCallback(((e,t)=>{h((s=>{const r=o(s);return r.length=n,r[e]=t,r}))}),[n]),p=e.exports.useCallback((()=>{const e=o(m);for(let t=0;t<n;t++)e[t]||(e[t]=0);l(e),h(new Array(n))}),[n,l,m]),d=e.exports.useCallback((()=>{u(),h(new Array(n))}),[n,u]);return t.createElement(i,{title:r,visible:s,onOk:p,onCancel:d,className:b},new Array(n).fill(!0).map(((e,s)=>t.createElement(c,{min:void 0===a?null:0,key:s,onChange:e=>f(s,e),value:m[s]||0}))))}));function A(e,t){let s;return s=e.length>=t?o(e.slice(0,t)):[...o(e),...new Array(t-e.length)],s}function S(e,t,s){e=o(e),t=o(t);for(let r=0;r<e.length;r++)if(e[r]=(Number(e[r])||0)+(Number(t[r])||0),e[r]<0&&(e[r]=0),e[r]>(Number(s[r])||0))return{status:!1};return{status:!0,res:e}}function q(e){return e||"--"}class I{constructor(e,t,s,r){if(this.procNum=e,this.resNum=t,this.resQuants=o(s),this.maxes=(()=>{const t=[];for(let s=0;s<e;s++)t.push(o(r[s][0]));return t})(),this.allocs=(()=>{const t=[];for(let s=0;s<e;s++)t.push(o(r[s][1]));return t})(),this._initData(),this._ensureValidData(),this.res=null,this._checkInput())try{this._computeNeeds(),this._computeWorks(),this._computeSeq()}catch(n){this.res={status:null}}else this.res={status:null}}_checkInput(){if(this.procNum<1)return!1;if(this.resQuants.reduce(((e,t)=>e+t),0)<1)return!1;for(let e=0;e<this.procNum;e++){if(this.maxes[e].reduce(((e,t)=>e+t),0)<1)return!1}return!0}_initData(){this.needs=[];for(let e=0;e<this.procNum;e++)this.needs.push([]);this.works=new Array(this.resNum),this.finishes=new Array(this.procNum),this.l=0,this.bq=new Array(this.procNum)}_ensureValidData(){const e=e=>{for(let t=0;t<e.length;t++)e[t]||(e[t]=0)};e(this.resQuants);for(let t=0;t<this.procNum;t++)e(this.maxes[t]);for(let t=0;t<this.procNum;t++)e(this.allocs[t])}_computeNeeds(){for(let e=0;e<this.procNum;e++){this.needs[e]=[];for(let t=0;t<this.resNum;t++)this.needs[e][t]=this.maxes[e][t]-this.allocs[e][t]}}_computeWorks(){for(let e=0;e<this.resNum;e++)this.works[e]=this.resQuants[e];for(let e=0;e<this.procNum;e++)for(let t=0;t<this.resNum;t++)this.works[t]-=this.allocs[e][t]}_computeSeq(){this.l=0;for(let e=0;e<this.procNum;e++)this.finishes[e]=!1;for(;this.l<this.procNum;){let e=!1;for(let t=0;t<this.procNum;t++){if(this.finishes[t])continue;let s;for(s=0;s<this.resNum&&!(this.needs[t][s]>this.works[s]);s++);if(s===this.resNum){e=!0,this.bq[this.l]=t,this.l++,this.finishes[t]=!0;for(let e=0;e<this.resNum;e++)this.works[e]+=this.allocs[t][e]}}if(!e)break}}get(){if(this.res)return this.res;if(this.l===this.procNum){const e={status:!0,query:[]};for(let t=0;t<this.l;t++)e.query.push(this.bq[t]);this.res=e}else this.res={status:!1};return this.res}}var O=e.exports.memo((function(){const[s,n]=e.exports.useState(3),[a,l]=e.exports.useState(new Array(s));e.exports.useEffect((()=>l((e=>A(e,s)))),[s]);const[i,c]=e.exports.useState(new Array(s));e.exports.useEffect((()=>c((e=>A(e,s).fill(0)))),[s]);const[h,f]=e.exports.useState([]);e.exports.useEffect((()=>{f((e=>(e.forEach((e=>{e[0]=A(e[0],s),e[1]=new Array(s)})),e)))}),[s]);const p=e.exports.useCallback((()=>{f((e=>{const t=h.length;if(e.length===t){const r=A(e,t+1);for(let n=e.length;n<t+1;n++)r[n]=[new Array(s),new Array(s)];return r}return e}))}),[h.length,s]),[x,N]=e.exports.useState(-1),_=e.exports.useCallback((e=>{0===x?l(e):x>0&&f((t=>{const s=o(t);return s[x-1][0]=e,s})),N(-1)}),[x]),[k,g]=e.exports.useState(-1),y=e.exports.useCallback((e=>{let t=!0;f((s=>{const r=o(s),n=S(r[k-1][1],e,r[k-1][0]);return console.log(r[k-1][1],e,r[k-1][0]),t=n.status,t?(r[k-1][1]=n.res,r):s})),c((s=>{const r=S(s,e,a);return t=t&&r.status,t?r.res:s})),t?(u.success("已分配资源"),g(-1)):u.error("资源不足")}),[a,k]),[w,b]=e.exports.useState(null),[O,z]=e.exports.useState([0]);e.exports.useEffect((()=>{const e=new I(h.length,s,a,h);if(b(e.get().status),e.get().status){const t=[0],s=e.get().query;for(let e=0;e<h.length;e++)t.push(s.indexOf(e)+1);z(t)}else z([0])}),[a,h,s]);const B=[{key:"total",name:"总资源数",max:a,alloc:i,order:0}];h.forEach(((e,t)=>{B.push({key:`p${t}`,name:`P${t}`,max:e[0],alloc:e[1],order:O[t+1]})}));const D=[{title:"进程",dataIndex:"name",key:"name",align:"center",width:"6rem"}];for(let e=0;e<s;e++)D.push({title:0===e?"最多":null,colSpan:0===e?s:0,dataIndex:["max",e],key:`max${e}`,align:"center",render:q});for(let e=0;e<s;e++)D.push({title:0===e?"分配":null,colSpan:0===e?s:0,dataIndex:["alloc",e],key:`alloc${e}`,align:"center",render:q});return D.push({title:"控制",key:"ctrl",align:"center",width:"12rem",render:(e,s,n)=>t.createElement(t.Fragment,null,t.createElement(r,{size:"small",onClick:()=>N(n)},"设置",0===n?"总量":"最多"),t.createElement(r,{size:"small",disabled:0===n,onClick:()=>g(n)},"申请资源"))},{title:"顺序",key:"order",dataIndex:"order",align:"center",width:"4rem",render:q}),t.createElement("div",{className:d.container},t.createElement(E,null),t.createElement("main",null,t.createElement(v,{resNum:s,onResNumChange:e=>n(e),onProcessAdd:p,status:w}),t.createElement("div",{className:d.data},t.createElement(m,{dataSource:B,columns:D,size:"middle",bordered:!0,pagination:!1})),t.createElement(C,{visible:x>=0,title:"设置资源数",num:s,min:0,onOk:_,onCancel:()=>N(-1)}),t.createElement(C,{visible:k>0,title:"申请资源数",num:s,onOk:y,onCancel:()=>g(-1)})))}));h.render(t.createElement(f,{locale:p},t.createElement(O,null)),document.getElementById("root"));
